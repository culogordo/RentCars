var addCarModule=angular.module("addCarModule",["ui.router","angularSpinner"]);addCarModule.config(["$stateProvider",function(a){a.state("addCar",{url:"/cars/addCar",templateUrl:"app/addCar/addCar.html",controller:"addCarCtrl"})}]);var carsModule=angular.module("carsModule",["ui.router"]);carsModule.config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("cars",{url:"/cars",templateUrl:"app/allCars/cars.html",controller:"carsCtrl",resolve:{carsPromise:["cars",function(a){return a.getAll()}]}}),b.otherwise("cars")}]);var rentCarsApp=angular.module("rentCarsApp",["angularSpinner","carsModule","aboutCarModule","addCarModule","authModule","editCarModule","feedbacksModule","ordersModule","ui.bootstrap"]),authModule=angular.module("authModule",["ui.router"]);authModule.config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/authentification/login.html",controller:"authCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()&&a.go("cars")}]}).state("register",{url:"/register",templateUrl:"app/authentification/register.html",controller:"authCtrl",onEnter:["$state","auth",function(a,b){b.isLoggedIn()&&a.go("cars")}]})}]);var aboutCarModule=angular.module("aboutCarModule",["angularSpinner","ui.router"]);aboutCarModule.config(["$stateProvider",function(a){a.state("aboutCar",{url:"/cars/aboutCar_{id}",templateUrl:"app/aboutCar(addOrder)/aboutCar.html",controller:"aboutCarCtrl",resolve:{carInfo:["$stateParams","cars",function(a,b){return b.getCarInfo(a.id)}]}})}]);var editCarModule=angular.module("editCarModule",["ui.router"]);editCarModule.config(["$stateProvider",function(a){a.state("editCar",{url:"/cars/editCar_{id}",templateUrl:"app/editCar/editCar.html",controller:"editCarCtrl",resolve:{carInfo:["$stateParams","cars",function(a,b){return b.getCarInfo(a.id)}]}})}]);var feedbacksModule=angular.module("feedbacksModule",["angularSpinner","ui.router","slick"]);feedbacksModule.config(["$stateProvider",function(a,b){a.state("feedbacks",{url:"/feedbacks",templateUrl:"app/feedbacks/feedbacks.html",controller:"feedbacksCtrl",resolve:{feedbacksPromise:["feedbacks",function(a){return a.getFeedbacks()}]}})}]);var ordersModule=angular.module("ordersModule",["ui.router"]);ordersModule.config(["$stateProvider",function(a){a.state("orders",{url:"/orders",templateUrl:"app/orders/orders.html",resolve:{}})}]),angular.module("rentCarsApp").directive("ngFileSelect",function(){return{link:function(a,b){b.bind("change",function(b){a.file=b.target.files[0],console.log(a.file),a.getFile()})}}}),angular.module("rentCarsApp").directive("ngAttempt",function(){return{restrict:"A",controller:["$scope",function(a){this.attempted=!1,this.setAttempted=function(){this.attempted=!0}}],link:function(a,b,c,d){var e=c.name;a.attempt=a.attempt||{},a.attempt[e]=d,b.bind("submit",function(b){d.setAttempted(),a.$$phase||a.$apply()})}}}),angular.module("rentCarsApp").directive("ngValidation",["$parse",function(a){return{restrict:"A",require:"form",link:function(b,c,d,e){var f=a(d.ngValidation);c.bind("submit",function(a){return e.$valid?void b.$apply(function(){f(b,{$event:a})}):!1})}}}]),angular.module("rentCarsApp").directive("ngModalPopUp",function(){return{restrict:"E",templateUrl:"/app/directives/modalPopUp/modalPopUp.html",transclude:!0,replace:!0,scope:!0,link:function(a,b,c){a.title=c.title,a.$watch(c.visible,function(a){a===!0?$(b).modal("show"):$(b).modal("hide")}),$(b).on("shown.bs.modal",function(){a.$$phase||a.$apply(function(){a.$parent[c.visible]=!0})}),$(b).on("hidden.bs.modal",function(){a.$$phase||a.$apply(function(){a.$parent[c.visible]=!1})})}}}),angular.module("rentCarsApp").directive("ngDatePicker",["$parse",function(a){return{restrict:"A",link:function(a){$(function(){var b=$("#addOrderDatePickerFrom"),c=$("#addOrderDatePickerTo"),d=$("#addOrderDatePickerBirth"),e=$("#inputAddOrderDatePickerFrom"),f=$("#inputAddOrderDatePickerTo"),g=$("#inputAddOrderDatePickerBirth");b.datetimepicker({format:"YYYY-MM-DD HH:mm",minDate:moment()}),c.datetimepicker({format:"YYYY-MM-DD HH:mm",minDate:moment().date(moment().date()+1)}),d.datetimepicker({viewMode:"years",format:"YYYY-MM-DD",maxDate:moment().subtract(18,"years"),minDate:"1900-01-01 00:00"}),b.on("dp.change",function(b){c.data("DateTimePicker").minDate(b.date),a.from=b.date.format("YYYY-MM-DD HH:mm")}),e.on("input",function(b){a.from=e.val()}),c.on("dp.change",function(c){b.data("DateTimePicker").maxDate(c.date),a.to=c.date.format("YYYY-MM-DD HH:mm")}),f.on("input",function(b){a.to=f.val()}),d.on("dp.change",function(b){a.dateBirth=b.date.format("YYYY-MM-DD")}),g.on("input",function(b){a.dateBirth=g.val()})})}}}]),angular.module("addCarModule").controller("addCarCtrl",["$scope","cars","fileReader",function(a,b,c){a.max=100,a.progress=0,a.currentYear=(new Date).getFullYear(),a.getFile=function(){c.readAsDataUrl(a.file,a).then(function(b){a.imageSrc=b})},a.$on("fileProgress",function(b){a.progress=b.loaded/b.total}),a.addCar=function(){var c={model:angular.uppercase(a.model),year:a.year,doors:a.doors,airConditioner:a.airConditioner,autoTransmission:a.autoTransmission,vin:angular.uppercase(a.vin),price:a.price,image:a.imageSrc||"/img/noCar.png",orders:[]};b.create(c)}}]),angular.module("rentCarsApp").directive("loader",function(){return{restrict:"E",replace:!0,scope:{key:"@"},link:function(a,b,c){a.$on("us-spinner:spin",function(c,d){d===a.key&&b.addClass("loading")}),a.$on("us-spinner:stop",function(c,d){d===a.key&&b.removeClass("loading")})},template:'<div class="us-spinner-wrapper"><div us-spinner spinner-key="{{key}}"></div></div>'}}),angular.module("rentCarsApp").directive("ngPhoneHelper",["$parse",function(a){return{restrict:"A",link:function(a){var b=$("#aboutCarPhoneNumber");b.intlTelInput(),b.on("input",function(c){a.phoneNumber=b.val(),a.$$phase||a.$apply()});var c=$("#feedbackPhoneNumber");c.intlTelInput(),c.on("input",function(b){a.o.phoneNumber=c.val(),a.$$phase||a.$apply()})}}}]),angular.module("editCarModule").controller("editCarCtrl",["$scope","cars","fileReader","carInfo",function(a,b,c,d){a.car=d,a.max=100,a.progress=0,a.currentYear=(new Date).getFullYear(),a.getFile=function(){c.readAsDataUrl(a.file,a).then(function(b){a.imageSrc=b})},a.$on("fileProgress",function(b){a.progress=b.loaded/b.total}),a.editCar=function(){b.editCar(a.car._id,a.car)}}]),angular.module("aboutCarModule").controller("aboutCarCtrl",["$scope","$location","carInfo","cars","usSpinnerService",function(a,b,c,d,e){a.car=c,a.sortType="from",a.sortReverse=!1,a.searchOrders="",a.showModal=!1,a.toggleModal=function(){a.showModal=!a.showModal},a.removeCar=function(c){d.removeCar(c).success(function(c){e.stop("mainSpinner"),a.showModal=!1,b.path("/cars")})},a.addOrder=function(){var b={from:new Date(a.from),to:new Date(a.to),startLocation:a.startLocation,finishLocation:a.finishLocation,addInfo:a.addInfo,firstName:a.firstName,lastName:a.lastName,dateBirth:new Date(a.dateBirth),docNumber:a.docNumber,phoneNumber:a.phoneNumber};d.addOrder(c._id,b).success(function(b){e.stop("mainSpinner"),a.car.orders.push(b)})}}]),angular.module("feedbacksModule").controller("feedbacksCtrl",["$scope","feedbacks","usSpinnerService",function(a,b,c){a.o={},a.feedbacks=b.feedbacks,a.showModal=!1,a.toggleModal=function(){a.showModal=!a.showModal},a.addFeedback=function(){var d={name:a.o.name,phoneNumber:a.o.phoneNumber,text:a.o.text,approved:!1};b.createFeedback(d).success(function(b){c.stop("mainSpinner"),a.toggleModal()})}}]),angular.module("authModule").controller("authCtrl",["$scope","$state","auth",function(a,b,c){a.user={},a.register=function(){c.register(a.user).error(function(b){a.error=b}).then(function(){b.go("cars")})},a.logIn=function(){c.logIn(a.user).error(function(b){a.error=b}).then(function(){b.go("cars")})}}]),angular.module("feedbacksModule").factory("feedbacks",["$http","$location","usSpinnerService",function(a,b,c){var d={feedbacks:[]};return d.getFeedbacks=function(){return c.spin("mainSpinner"),a.get("/getFeedbacks").success(function(a){angular.copy(a,d.feedbacks),c.stop("mainSpinner")})},d.createFeedback=function(b){return c.spin("mainSpinner"),a.post("/postFeedback",b)},d}]),angular.module("rentCarsApp").controller("navigationCtrl",["$scope","$location","auth","doSearchService","$rootScope","usSpinnerService",function(a,b,c,d,e,f){a.navigation={url:"app/navigationBar/navBar.html"},a.isLoggedIn=c.isLoggedIn,a.currentUser=c.currentUser,a.logOut=c.logOut,a.searchExpression={},a.sortType="from",a.sortReverse=!1,a.searchOrders="",a.doSearch=function(){return""===a.searchExpression.text?(a.data=null,void(e.globalSearch=!1)):void d(a.searchExpression.text).then(function(b){f.stop("mainSpinner"),a.data=b,e.globalSearch=!0},function(a){f.stop("mainSpinner"),alert("Some error in input search!")})},a.isActive=function(a){var c=a===b.path();return c}}]),angular.module("carsModule").controller("carsCtrl",["$scope","cars",function(a,b){a.cars=b.cars}]),angular.module("rentCarsApp").factory("auth",["$http","$window","usSpinnerService",function(a,b,c){var d={};return d.saveToken=function(a){b.localStorage["rent-cars-token"]=a},d.getToken=function(){return b.localStorage["rent-cars-token"]},d.isLoggedIn=function(){var a=d.getToken();if(a){var c=JSON.parse(b.atob(a.split(".")[1]));return c.exp>Date.now()/1e3}return!1},d.currentUser=function(){if(d.isLoggedIn()){var a=d.getToken(),c=JSON.parse(b.atob(a.split(".")[1]));return c.username}},d.register=function(b){return c.spin("mainSpinner"),a.post("/register",b).success(function(a){c.stop("mainSpinner"),d.saveToken(a.token)})},d.logIn=function(b){return c.spin("mainSpinner"),a.post("/login",b).success(function(a){c.stop("mainSpinner"),d.saveToken(a.token)})},d.logOut=function(){b.localStorage.removeItem("rent-cars-token")},d}]),angular.module("rentCarsApp").factory("cars",["$http","$location","auth","usSpinnerService",function(a,b,c,d){var e={cars:[]};return e.getAll=function(){return d.spin("mainSpinner"),a.get("/getAllcars").success(function(a){d.stop("mainSpinner"),angular.copy(a,e.cars)})},e.create=function(c){return d.spin("mainSpinner"),a.post("/postCar",c).success(function(a){d.stop("mainSpinner"),b.path("/cars")})},e.editCar=function(c,e){return d.spin("mainSpinner"),a.put("/editCar_"+c,e).success(function(a){d.stop("mainSpinner"),b.path("/cars")})},e.getCarInfo=function(b){return d.spin("mainSpinner"),a.get("/allcars/getCar_"+b).then(function(a){return d.stop("mainSpinner"),a.data})},e.addOrder=function(b,c){return d.spin("mainSpinner"),a.post("/allcars/"+b+"/allorders",c)},e.removeCar=function(b){return d.spin("mainSpinner"),a["delete"]("/allcars/deleteCar_"+b)},e}]),angular.module("rentCarsApp").factory("doSearchService",["$http","usSpinnerService",function(a,b){var c=function(c){return b.spin("mainSpinner"),a.get("/getSearchResult",{params:{expression:c}})};return c}]),angular.module("rentCarsApp").factory("fileReader",["$q","$log",function(a,b){var c=function(a,b,c){return function(){c.$apply(function(){b.resolve(a.result)})}},d=function(a,b,c){return function(){c.$apply(function(){b.reject(a.result)})}},e=function(a,b){return function(a){b.$broadcast("fileProgress",{total:a.total,loaded:a.loaded})}},f=function(a,b){var f=new FileReader;return f.onload=c(f,a,b),f.onerror=d(f,a,b),f.onprogress=e(f,b),f},g=function(b,c){var d=a.defer(),e=f(d,c);return e.readAsDataURL(b),d.promise};return{readAsDataUrl:g}}]);